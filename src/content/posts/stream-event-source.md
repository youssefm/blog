---
title: "Async iteration of Server-sent events with stream-event-source"
description: "Asynchronous iteration seems especially well suited for Server-sent events. In this post, we introduce a new npm package for reading SSEs through the async iteration protocol."
publishedOn: 2023-10-21
---

One of my favorite features added to Javascript in recent years is [asynchronous iteration](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of). It allows you to take an asynchronous iterable object and have the code in your loop execute each time a Promise to fetch the next value resolves. The end result is code that looks very much like a simple `for...of` loop, and is often more readable and simpler to reason about than the alternatives.

One use case for which async iteration seems especially well tailored is the streaming of Server-sent events or SSE. SSE has become especially popular lately as a way of sending streaming events back from a server, finding its way into many popular AI applications, including [ChatGPT](https://dev.to/rohitdhas/how-chatgpt-uses-server-sent-events-to-stream-real-time-conversation-3976) and the AI product I happen to work on, [Pi](https://pi.ai). In these cases, the server is able to send events with partial text updates as they get generated by the large language model in real time.

So today, I'd like to introduce a package that lets you apply async iteration to Server-sent events. [`stream-event-source`](https://github.com/youssefm/stream-event-source) is a small package that provides you with an async iterator over any stream of SSE events. It's a thin wrapper on top of Microsoft's [`fetch-event-source`](https://github.com/Azure/fetch-event-source#fetch-event-source) package and works seamlessly both in the browser and within Node. Here's a simple example showing how to stream changes to Wikimedia in real time:

```ts {5-8}
import { streamEventSource } from "stream-event-source";

async function main() {
  const controller = new AbortController();
  const stream = streamEventSource(
    "https://stream.wikimedia.org/v2/stream/recentchange",
    { signal: controller.signal },
  );

  const now = Date.now();

  for await (const event of stream) {
    console.log(event.event);
    console.log(event.data);

    if (Date.now() - now > 5000) {
      controller.abort();
      break;
    }
  }
}

main();
```

To get started with `stream-event-source` today, simply install it with your favorite package manager:

```bash
npm install stream-event-source
```
